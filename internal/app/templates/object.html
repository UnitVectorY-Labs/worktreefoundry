<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>{{.TypeName}} item</title>
  <link rel="stylesheet" href="/static/app.css">
</head>
<body>
  {{template "topbar" .Top}}
  <main class="page">
    {{if .Flash}}
    <section class="notice {{if .FlashError}}error{{else}}ok{{end}}">{{.Flash}}</section>
    {{end}}

    <section class="panel">
      <div class="panel-head row-between">
        <div>
          <h1>{{.TypeName}} {{if .ID}}Item{{else}}New Item{{end}}</h1>
          {{if .ID}}<p><code>{{.ID}}</code></p>{{end}}
        </div>
        <a class="btn" href="{{.BackURL}}">Back to list</a>
      </div>

      {{if .Missing}}
      <div class="empty-state">
        <p>{{.MissingReason}}</p>
        {{if .CanRestore}}
        <form method="post" action="{{.RestoreURL}}" class="inline-form">
          <button class="btn" type="submit">Restore Item</button>
        </form>
        {{end}}
      </div>
      {{else}}
      <form method="post" action="{{.WriteURL}}" class="form-grid">
        <input type="hidden" name="id" value="{{.ID}}">

        {{range .Fields}}
          {{$fieldName := .Name}}
          {{$fieldValue := index $.FieldValues .Name}}
          <label>{{$fieldName}} {{if .Required}}*{{end}}</label>
          {{if eq .Type "string"}}
            {{if .Enum}}
              <select name="field.{{$fieldName}}" {{if $.ReadOnly}}disabled{{end}}>
                <option value=""></option>
                {{range .Enum}}
                  <option value="{{.}}" {{if eq $fieldValue .}}selected{{end}}>{{.}}</option>
                {{end}}
              </select>
            {{else}}
              <input type="text" name="field.{{$fieldName}}" value="{{$fieldValue}}" {{if $.ReadOnly}}disabled{{end}}>
            {{end}}
          {{else if or (eq .Type "number") (eq .Type "integer")}}
            <input type="text" name="field.{{$fieldName}}" value="{{$fieldValue}}" {{if $.ReadOnly}}disabled{{end}}>
          {{else if eq .Type "boolean"}}
            <select name="field.{{$fieldName}}" {{if $.ReadOnly}}disabled{{end}}>
              <option value=""></option>
              <option value="true" {{if eq $fieldValue "true"}}selected{{end}}>true</option>
              <option value="false" {{if eq $fieldValue "false"}}selected{{end}}>false</option>
            </select>
          {{else if eq .Type "array"}}
            <input type="text" name="field.{{$fieldName}}" value="{{$fieldValue}}" {{if $.ReadOnly}}disabled{{end}}>
            <div class="hint">Comma-separated {{.ItemsType}} values</div>
          {{end}}
        {{end}}

        {{if not .ReadOnly}}
        <div class="actions" style="margin-top:0.8rem;">
          <button class="btn primary" type="submit">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 4h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2"/><path d="M6 12h12"/></svg>
            Update Draft
          </button>
          {{if .ID}}
          <form method="post" action="{{.DeleteURL}}" class="inline-form">
            <button class="btn danger" type="submit">Delete Item</button>
          </form>
          {{end}}
        </div>
        {{end}}
      </form>
      {{end}}

      {{if .Diffs}}
      <section class="subpanel">
        <h3>Workspace vs Main</h3>
        <table class="table">
          <thead><tr><th>Field</th><th>Main</th><th>Workspace</th><th>Status</th></tr></thead>
          <tbody>
            {{range .Diffs}}
            <tr>
              <td><code>{{.Field}}</code></td>
              <td>{{.Main}}</td>
              <td>{{.Workspace}}</td>
              <td>{{.Status}}</td>
            </tr>
            {{end}}
          </tbody>
        </table>
      </section>
      {{end}}
    </section>
  </main>
</body>
</html>
